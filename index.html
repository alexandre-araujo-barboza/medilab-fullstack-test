<!DOCTYPE html>
<!--
  ATENÇÃO: O USO DO MÉTODO GET NO AJAX REQUER QUE O PROGRAMA SEJA ABERTO NO SERVIDOR WEB
-->
<html>
  <head>
    <meta charset="utf-8" />
	  <meta name="viewport" content="width=device-width, initial-scale=1.0">
	  <meta name="description" content="MedLab, prova fullstack." />
    <meta name="Author" content="Alexandre A. Barbosa, alexandre.araujo.barboza@gmail.com" />
	  <meta name="robots" content="noindex" />
    <title>Full Stack Admission Test</title>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs-3.3.7/dt-1.11.4/datatables.min.css"/>
    <script type="text/javascript" src="assets/js/jquery-3.6.0.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/v/bs-3.3.7/dt-1.11.4/datatables.min.js"></script>
    <script>
      function loadJson() {
        user = "assets/json/data.json"; // Faz a leitura do arquivo JSON.
	      $.ajax({
          url:      user,
          type:     'GET',
          cache:    false,
	        dataType: 'json',
		      complete: function (content, status) {
            if (status === 'error' || !content.responseText) {
              alert(content.status + " " + content.statusText + "\nCan not read input file...");
            } else {
		          localStorage.setItem("json_data", content.responseText); // Grava dados do JSON no cache.
		          location.reload(); // Recarrega a página.
            }
		      }	
	      });
      }
      $(document).ready(function() {
	      var data = localStorage.getItem("json_data"); // Faz a leitura diretamente do cache.
	      var parsed;
	      if (data) { // Se houverem dados no cache. 
	        try {
            parsed = $.parseJSON(data); // Carrega objeto com o JSON.
            console.log(parsed);
             
          } catch (e) {
            alert("Can not read JSON data!\n" + e);
          }
	      } else { // Se não houverem dados no cache. 
	        loadJson(); // Faz a leitura do arquivo JSON.
        }
        
        var dataSet = []; 
        for (var i =0 ; i < parsed.length; i++) { // Transforma o JSON em matriz.
          var dataRow = [];
          dataRow.push(parsed[i].nome);
          dataRow.push(parsed[i].numAcesso);
          dataRow.push(parsed[i].visita);
          dataRow.push(parsed[i].patientID);
          dataRow.push(parsed[i].data);
          dataRow.push(parsed[i].modalidade);
          dataRow.push(parsed[i].tipoExame);
          dataRow.push(parsed[i].numero);
          dataRow.push(parsed[i].estado);
          dataRow.push(parsed[i].medSol);
          dataRow.push(parsed[i].laudo);
          dataRow.push(parsed[i].sexo);
          dataRow.push(parsed[i].especial);
          dataRow.push(parsed[i].urgente);
          dataRow.push(parsed[i].restaurado);
          dataSet.push(dataRow);
        } 
        console.log(dataSet);
        
        $('#myTable').DataTable( {
          stateSave: true,
          data: dataSet,
          columns: [
            { title: "nome" },
            { title: "numAcesso" },
            { title: "visita" },
            { title: "patientID" },
            { title: "data" },
            { title: "modalidade" },
            { title: "tipoExame" },
            { title: "numero" },
            { title: "estado" },
            { title: "medSol" },
            { title: "laudo" },
            { title: "sexo" },
            { title: "especial" },
            { title: "urgente" },
            { title: "restaurado" }
          ]
        }); 
        $("#ofFile").click(function(event) { // Botão de RESET, carrega outro JSON no cache.
          loadJson(); // Faz a leitura do arquivo JSON.
        });         
      });
    </script>
  </head>
  <body>
    <table id="myTable" class="display" width="100%"></table>
    <input id="ofFile" type="button" value="New JSON" />
  </body>
</html>    